---
import { api } from '@/lib/api';

interface Props {
  title?: string;
  description?: string;
  primaryButton?: { text: string; href: string };
  secondaryButton?: { text: string; href: string };
}

interface PageSection {
  title?: string | null;
  subtitle?: string | null;
  body_html?: string | null;
  cta_label?: string | null;
  cta_url?: string | null;
}

const defaultTitle = "Ready for Your Next Adventure?";
const defaultDescription =
  "Join thousands of happy trekkers who have discovered the magic of the Himalayas with us. Your adventure of a lifetime awaits.";
const defaultPrimary = { text: "Explore Treks", href: "/treks" };
const defaultSecondary = { text: "Contact Us", href: "/contact" };

let section: PageSection | null = null;

try {
  const sections = await api.get<PageSection[]>(`/content/home`);
  section = sections.find((s) => (s as any).key === "cta") || null;
} catch (error) {
  console.error('Failed to fetch home CTA content, using defaults:', error);
}

const {
  title = section?.title || defaultTitle,
  description = section?.subtitle || defaultDescription,
  primaryButton = {
    text: section?.cta_label || defaultPrimary.text,
    href: section?.cta_url || defaultPrimary.href,
  },
  secondaryButton = defaultSecondary,
} = Astro.props;
---

<section class="section bg-secondary-600 relative overflow-hidden">
  <!-- Background pattern -->
  <div class="absolute inset-0 opacity-5">
    <svg class="w-full h-full" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <pattern id="cta-pattern" x="0" y="0" width="40" height="40" patternUnits="userSpaceOnUse">
          <circle cx="20" cy="20" r="2" fill="currentColor" class="text-white"/>
        </pattern>
      </defs>
      <rect width="100%" height="100%" fill="url(#cta-pattern)"/>
    </svg>
  </div>

  <!-- Gradient overlays - Orange accents -->
  <div class="absolute top-0 left-0 w-96 h-96 bg-primary-500/20 rounded-full blur-3xl"></div>
  <div class="absolute bottom-0 right-0 w-96 h-96 bg-primary-400/20 rounded-full blur-3xl"></div>

  <div class="container-custom relative z-10">
    <div class="max-w-3xl mx-auto text-center">
      <h2 class="text-3xl md:text-4xl lg:text-5xl font-bold text-white mb-6">
        {title}
      </h2>
      <p class="text-lg text-white/80 mb-10 leading-relaxed">
        {description}
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a href={primaryButton.href} class="btn bg-gradient-to-r from-primary-600 to-primary-500 text-white hover:from-primary-700 hover:to-primary-600 px-8 py-4 text-lg shadow-lg shadow-primary-500/30">
          {primaryButton.text}
          <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
          </svg>
        </a>
        <a href={secondaryButton.href} class="btn border-2 border-white/30 text-white hover:bg-white/10 px-8 py-4 text-lg">
          {secondaryButton.text}
        </a>
      </div>
    </div>
  </div>
</section>
